name: CI
on: [push, pull_request]
jobs:
    ci-nix:
        strategy:
            fail-fast: false
            matrix:
                os: [ubuntu-latest, macos-latest]
        runs-on: ${{ matrix.os }}
        steps:
        - uses: actions/checkout@v2
        - uses: actions/setup-java@v1
          with:
            java-version: 8
        - name: Compile
          run: ./sbt compile
        - name: Test
          run: ./sbt jacoco
    ci-win:
        runs-on: windows-latest
        strategy:
            fail-fast: false
            matrix:
                include: [
                    { msystem: MINGW64, arch: x86_64, java_arch: x64 },
                    { msystem: MINGW32, arch: i686,   java_arch: x86 }
                ]
        defaults:
            run:
                shell: msys2 {0}
        steps:
        - uses: actions/checkout@v2
        - uses: msys2/setup-msys2@v2
          with:
            msystem: ${{ matrix.msystem }}
            install: git base-devel mingw-w64-${{ matrix.arch }}-toolchain
            path-type: inherit
            update: true
        - uses: emgre/setup-java@master
          with:
            java-version: 8
            architecture: ${{ matrix.java_arch }}
        - name: Check Java version
          run: java -version
        - name: Compile
          run: ./sbt compile
        - name: Test
          run: ./sbt jacoco
